const express=require("express"),cors=require("cors"),port=process.env.PORT||5e3,app=express();app.use(cors()),app.use(express.json()),app.use(express.urlencoded());let postData=[{id:"axsdfajfkd;as12fj;alkd318",title:"Sour Dough",date:(new Date).toLocaleString(),author:"YeastOverLord",content:"I like sour dough bread",type:"text",score:0,numOfComments:0},{id:"axsdfajfkd;a4241adsfqjbja",title:"My first attempt at baking",date:(new Date).toLocaleString(),author:"YaBoiBread",content:"I tried to make some bread",type:"img",img:"/src/placeholder.jpg",score:0,numOfComments:0}],commentData=[{id:"fdeajdfk;j812094fkfad",postID:"axsdfajfkd;as12fj;alkd318",date:(new Date).toLocaleString(),author:"PastryChef32",content:"Nice",score:0},{id:"jfajd;sfe71380cmzhyek",postID:"axsdfajfkd;a4241adsfqjbja",date:(new Date).toLocaleString(),author:"Dough_Fan29",content:"Looks great",score:0}],users=[{id:"admin_account",username:"Admin",password:"Password",posts:0,comments:0,votedPosts:[]},{id:"jfajd;sfe71380ceufad;sjk8",username:"PastryChef32",password:"RisingDough32",posts:0,comments:1,votedPosts:[]},{id:"jfajd;sfeqfu8a01j2kjfke",username:"YaBoiBread",password:"Doughness9",posts:0,comments:1,votedPosts:[]}];app.get("/posts",((s,e)=>{e.send(postData)})),app.get("/posts/:id",((s,e)=>{const t=s.params.id;let o=postData.filter((s=>s.id===t))[0];e.send(o)})),app.put("/posts/:id",((s,e)=>{const{id:t,value:o,user:a}=s.body;console.log(a);let d=postData.findIndex((s=>s.id===t)),r=users.findIndex((s=>s.id===a));users[r].votedPosts.includes(t)?(postData[d].score-=o,console.log(t),console.log(users[r].votedPosts),users[r].votedPosts=users[r].votedPosts.filter((s=>s.id!==t))):(postData[d].score+=o,users[r].votedPosts.push(t)),e.send(postData)})),app.get("/posts/:id/comments",((s,e)=>{const t=s.params.id;let o=commentData.filter((s=>s.postID===t));e.send(o)})),app.post("/users",((s,e)=>{let{username:t,password:o}=s.body,a=users.find((s=>s.username===t));a&&a.password===o?e.send({result:!0,user:a}):e.send({result:!1})})),app.listen(port,(()=>console.log("server listening on ",port)));